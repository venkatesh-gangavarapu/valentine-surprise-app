<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Valentine Surprise ‚ù§Ô∏è</title>

<style>
body{
  margin:0;
  font-family:'Segoe UI',sans-serif;
  background:linear-gradient(135deg,#ff9a9e,#fad0c4);
  display:flex;
  justify-content:center;
  align-items:center;
  min-height:100vh;
  text-align:center;
  overflow-x:hidden;
  padding:15px;
}

.card{
  background:white;
  padding:25px;
  border-radius:20px;
  box-shadow:0 10px 25px rgba(0,0,0,0.15);
  width:100%;
  max-width:420px;
  z-index:2;
}

button{
  padding:12px 20px;
  margin:10px 5px;
  font-size:16px;
  border:none;
  border-radius:25px;
  cursor:pointer;
}

.copyBtn{background:#198754;color:white}
.hidden{display:none}

input{
  padding:12px;
  width:95%;
  margin-top:10px;
  border-radius:10px;
  border:1px solid #ddd;
}

img{
  width:100%;
  max-height:50vh;
  object-fit:cover;
  border-radius:15px;
  margin-top:15px;
  border:5px solid #ff4d6d;
  padding:5px;
}

.status{font-size:14px;margin-top:10px;color:#555}

/* Floating hearts */
.heart{position:fixed;bottom:-10px;font-size:20px;animation:floatUp 6s linear infinite}
@keyframes floatUp{0%{transform:translateY(0);opacity:1}100%{transform:translateY(-110vh);opacity:0}}

/* Fireworks */
#fireworks{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:3}

/* Fancy tap screen */
#tapOverlay{
  position:fixed;
  inset:0;
  background:linear-gradient(135deg,#ff4d6d,#ff9a9e);
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  z-index:9999;
  color:white;
  text-align:center;
}

.tapHeart{
  font-size:60px;
  animation:heartbeat 1s infinite;
}

@keyframes heartbeat{
  0%{transform:scale(1)}
  25%{transform:scale(1.2)}
  40%{transform:scale(1)}
  60%{transform:scale(1.2)}
  100%{transform:scale(1)}
}

.tapText{
  font-size:22px;
  margin-top:15px;
  animation:fadePulse 2s infinite;
}

@keyframes fadePulse{
  0%{opacity:1}
  50%{opacity:.5}
  100%{opacity:1}
}
</style>
</head>

<body>

<!-- Tap to start overlay -->
<div id="tapOverlay" class="hidden">
  <div class="tapHeart">üíñ</div>
  <div class="tapText">Tap to Open Your Surprise</div>
  <div style="font-size:14px;margin-top:10px;opacity:.9">A special Valentine is waiting üíå</div>
</div>

<canvas id="fireworks"></canvas>

<audio id="music" loop preload="auto">
  <source src="love.mp3" type="audio/mpeg">
</audio>

<!-- SETUP -->
<div class="card" id="setup">
  <h2>Create a Valentine Surprise ‚ù§Ô∏è</h2>
  <input id="partnerName" placeholder="Partner's Name">

  <p style="margin-top:15px">Upload your photo together üì∏</p>
  <input type="file" id="photoUpload" accept="image/*">

  <button type="button" onclick="generateLink()">Generate Share Link</button>
  <div class="status" id="status"></div>

  <div id="shareArea" class="hidden">
    <p>Share this link with your partner üíå</p>
    <input id="shareLink" readonly>
    <button class="copyBtn" onclick="copyLink()">Copy Link</button>
  </div>
</div>

<!-- LOVE MESSAGE -->
<div class="card hidden" id="loveMessage">
  <h1 id="title"></h1>
  <p id="msg"></p>
  <img id="coupleImg">
</div>

<script src="https://sdk.amazonaws.com/js/aws-sdk-2.1480.0.min.js"></script>
<script>
AWS.config.update({
  accessKeyId:"YOUR_ACCESS_KEY",
  secretAccessKey:"YOUR_SECRET_KEY",
  region:"ap-south-1"
});

const s3=new AWS.S3();
let uploadedImageUrl="";
let partner="";

function playMusic(){document.getElementById("music").play().catch(()=>{})}
function setStatus(msg){document.getElementById("status").innerText=msg}

function compressImage(file){
  return new Promise(resolve=>{
    const img=new Image();
    const reader=new FileReader();
    reader.onload=e=>img.src=e.target.result;

    img.onload=()=>{
      const canvas=document.createElement("canvas");
      const ctx=canvas.getContext("2d");
      const maxWidth=800;
      const scale=maxWidth/img.width;
      canvas.width=maxWidth;
      canvas.height=img.height*scale;
      ctx.drawImage(img,0,0,canvas.width,canvas.height);
      canvas.toBlob(blob=>{
        resolve(new File([blob],file.name,{type:"image/jpeg"}));
      },"image/jpeg",0.7);
    };

    reader.readAsDataURL(file);
  });
}

async function uploadImage(file){
  const params={Bucket:"valentine-surprise-images",Key:Date.now()+"-"+file.name,Body:file,ContentType:file.type};
  const data=await s3.upload(params).promise();
  return data.Location;
}

async function generateLink(){
  try{
    partner=document.getElementById("partnerName").value||"My Love";
    const file=document.getElementById("photoUpload").files[0];
    if(!file){alert("Upload photo first");return}

    setStatus("Compressing image...");
    const compressed=await compressImage(file);

    setStatus("Uploading... ‚ù§Ô∏è");
    uploadedImageUrl=await uploadImage(compressed);

    const url=`${location.origin}${location.pathname}?name=${encodeURIComponent(partner)}&img=${encodeURIComponent(uploadedImageUrl)}`;
    document.getElementById("shareArea").classList.remove("hidden");
    document.getElementById("shareLink").value=url;
    setStatus("Done! Share the link üíå");
  }catch(e){setStatus("Upload failed ‚ùå")}
}

function copyLink(){
  const input=document.getElementById("shareLink");
  input.select();
  document.execCommand("copy");
  alert("Link copied ‚ù§Ô∏è");
}

// ===== READ SHARE LINK =====
// ===== STRICT RECEIVER MODE CHECK =====
const params = new URLSearchParams(window.location.search);

const nameParam = params.get("name");
const imgParam = params.get("img");

if(nameParam && imgParam){

  // Receiver mode ONLY
  partner = nameParam;
  uploadedImageUrl = imgParam;

  document.getElementById("setup").style.display = "none";
  document.getElementById("tapOverlay").style.display = "flex";

}else{

  // Creator mode ONLY
  document.getElementById("tapOverlay").style.display = "none";
}


// Tap to start
document.getElementById("tapOverlay").onclick=function(){
  this.style.display="none";
  showLove();
};

function showLove(){
  document.getElementById("loveMessage").classList.remove("hidden");
  document.getElementById("title").innerHTML=`Happy Valentine's Day ${partner} ‚ù§Ô∏è`;
  document.getElementById("msg").innerHTML=`To my dearest ${partner},<br><br>You make my world brighter every day.<br><br>You are my forever and always I love you more than words can say.<br><br>With you, every day feels like a beautiful dream.<br><br>In you, I‚Äôve found the love of my life and my closest, truest friend.<br><br>I love you always üíï`;
  document.getElementById("coupleImg").src=uploadedImageUrl;
  startHearts();
  startFireworks();
  playMusic();
}

function startHearts(){
  setInterval(()=>{
    const h=document.createElement("div");
    h.className="heart";
    h.innerHTML="üíñ";
    h.style.left=Math.random()*100+"vw";
    document.body.appendChild(h);
    setTimeout(()=>h.remove(),6000);
  },300);
}

function startFireworks(){
  const canvas=document.getElementById("fireworks");
  const ctx=canvas.getContext("2d");
  canvas.width=window.innerWidth;
  canvas.height=window.innerHeight;

  setInterval(()=>{
    ctx.clearRect(0,0,canvas.width,canvas.height);
    const x=Math.random()*canvas.width;
    const y=Math.random()*canvas.height/2;
    for(let i=0;i<30;i++){
      const a=Math.random()*2*Math.PI;
      const s=Math.random()*4+1;
      let px=x,py=y,life=30;
      const dx=Math.cos(a)*s;
      const dy=Math.sin(a)*s;
      const t=setInterval(()=>{
        ctx.fillStyle=`hsl(${Math.random()*360},100%,60%)`;
        ctx.fillRect(px,py,3,3);
        px+=dx;py+=dy;life--;
        if(life<=0) clearInterval(t);
      },30);
    }
  },800);
}
</script>

</body>
</html>
